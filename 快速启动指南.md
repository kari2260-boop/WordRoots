# 快速启动 K博士聊天功能

## 第一步：获取 DeepSeek API Key

1. **访问 DeepSeek 官网**
   ```
   https://platform.deepseek.com/
   ```

2. **注册账号**
   - 支持手机号注册
   - 国内可直接访问

3. **获取 API Key**
   - 登录后进入"API Keys"页面
   - 点击"创建新密钥"
   - 复制生成的 API Key（格式：sk-xxxxxxxxxxxxxxxx）

## 第二步：配置环境变量

编辑 `.env.local` 文件，添加：

```bash
# DeepSeek API Key
DEEPSEEK_API_KEY=sk-你的API密钥
```

## 第三步：重启服务器

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
npm run dev
```

## 第四步：测试聊天功能

1. 访问：http://localhost:3000/dashboard/chat
2. 发送消息："你好，K博士！"
3. 查看回复

## 自定义 K博士

### 方法1：修改配置文件（推荐）

编辑文件：`/src/lib/custom-dr-k-config.ts`

```typescript
export const CUSTOM_DR_K_CONFIG = {
  // 修改说话风格
  speakingStyle: `
你的自定义说话风格...
`,

  // 添加知识库
  knowledgeBase: {
    myTopic: `
### 你的主题
你的知识内容...
`,
  },

  // 添加场景提示词
  scenarioPrompts: {
    myScenario: `
你的场景提示词...
`,
  },
}
```

### 方法2：直接在文件中添加

1. 打开 `/src/lib/custom-dr-k-config.ts`
2. 找到对应的部分
3. 添加你的内容
4. 保存文件（服务器会自动重新编译）

## 示例：添加编程学习知识库

```typescript
knowledgeBase: {
  // ... 现有内容 ...

  programming: `
### 编程学习知识库
- 从简单项目开始，不要一上来就学框架
- 多动手写代码，少看视频教程
- 遇到bug先自己调试，培养解决问题能力
- 加入编程社区，和其他人交流
- 每天写一点，保持连续性
`,
}
```

然后在 `buildSystemPrompt` 函数中添加：

```typescript
export function buildSystemPrompt(userContext: string): string {
  return `${CUSTOM_DR_K_CONFIG.speakingStyle}

${userContext}

${CUSTOM_DR_K_CONFIG.knowledgeBase.learning}
${CUSTOM_DR_K_CONFIG.knowledgeBase.emotion}
${CUSTOM_DR_K_CONFIG.knowledgeBase.programming}  // 添加这行

...
`
}
```

## 查看日志

```bash
# 查看服务器日志
tail -f /private/tmp/claude-501/-Users-k/tasks/be8dc45.output

# 查看 AI 提供商
# 日志中会显示：🤖 Using AI provider: deepseek
```

## 常见问题

### Q: API Key 无效？
A: 检查是否正确复制了完整的 key，包括 `sk-` 前缀

### Q: 如何查看使用量？
A: 登录 DeepSeek 平台，查看"用量统计"

### Q: 免费额度够用吗？
A: 每天 500 万 tokens，相当于约 1 万次对话，个人使用完全够

### Q: 如何修改回复长度？
A: 在 `/src/lib/ai-client.ts` 中修改 `max_tokens` 参数（当前是 300）

### Q: 如何让 K博士更了解我？
A: 在 `custom-dr-k-config.ts` 的 `speakingStyle` 中添加你的个人风格描述

## 下一步

✅ 配置完成后，你可以：
1. 测试聊天功能
2. 根据需要调整 K博士的说话风格
3. 添加你自己的知识库
4. 自定义场景提示词
5. 查看聊天记录和提取的标签

需要帮助随时告诉我！
