# K博士配置管理系统使用指南

## 🎉 新功能：管理员端配置管理

现在你可以在管理员界面中直接管理 K博士的知识库和提示词，无需修改代码！

---

## 📍 访问地址

```
http://localhost:3000/admin/dr-k-config
```

---

## 🗄️ 第一步：创建数据库表

在使用管理界面之前，需要先在 Supabase 中创建数据库表。

### 方法一：使用 Supabase Dashboard

1. 登录 Supabase Dashboard
2. 进入你的项目
3. 点击左侧菜单的 "SQL Editor"
4. 复制 `/supabase/migrations/create_dr_k_config_tables.sql` 文件的内容
5. 粘贴到 SQL Editor 中
6. 点击 "Run" 执行

### 方法二：使用 Supabase CLI（如果已安装）

```bash
cd /Users/k/Desktop/pathforge-web
supabase db push
```

---

## 📚 三个配置类型

### 1. 知识库（Knowledge）
存储 K博士的专业知识，例如：
- 学习方法
- 情绪管理
- 人际关系
- 未来规划
- 编程学习
- 艺术创作
- 等等...

**字段**：
- 标题：知识库的名称
- 主题分类：例如 `learning`, `emotion`, `social`
- 内容：详细的知识内容

### 2. 场景提示词（Scenario）
针对不同场景的回复指导，例如：
- 孩子遇到困难
- 孩子分享成果
- 孩子表达负面情绪
- 日常闲聊
- 孩子提问

**字段**：
- 标题：场景名称
- 场景名称：例如 `difficulty`, `achievement`
- 内容：该场景下的回复指导

### 3. 说话风格（Prompt）
K博士的基本说话风格和原则，例如：
- 语气特点
- 用词习惯
- 回复长度
- 提问方式
- 禁止事项

**字段**：
- 标题：风格名称
- 分类：例如 `speaking_style`, `rules`
- 内容：具体的风格描述

---

## 🎯 使用流程

### 1. 添加知识库

1. 访问管理页面
2. 点击"知识库"标签
3. 点击"添加新知识"按钮
4. 填写表单：
   ```
   标题: 编程学习方法
   主题分类: programming
   内容:
   - 从简单项目开始，不要一上来就学框架
   - 多动手写代码，少看视频教程
   - 遇到bug先自己调试，培养解决问题能力
   - 加入编程社区，和其他人交流
   - 每天写一点，保持连续性
   ```
5. 点击"保存"

### 2. 添加场景提示词

1. 点击"场景提示词"标签
2. 点击"添加新场景"按钮
3. 填写表单：
   ```
   标题: 孩子遇到编程困难
   场景名称: programming_difficulty
   内容:
   当孩子说编程遇到困难时：
   1. 先共情："编程确实有挑战性，我理解你的感受"
   2. 肯定尝试："你愿意学习编程本身就很棒"
   3. 具体询问："能跟我说说具体卡在哪里了吗？"
   4. 引导思考："你觉得可以从哪里入手？"
   5. 提供支持："需要我给你一些思路吗？"
   ```
4. 点击"保存"

### 3. 添加说话风格

1. 点击"说话风格"标签
2. 点击"添加新风格"按钮
3. 填写表单：
   ```
   标题: 基本原则
   分类: speaking_style
   内容:
   - 用10-15岁孩子能理解的语言
   - 每次回复80-120字
   - 多用提问，少用陈述
   - 真诚鼓励，不过度表扬
   - 关注过程，不只看结果
   ```
4. 点击"保存"

---

## ✏️ 编辑和删除

- **编辑**：点击配置项右侧的"编辑"按钮
- **删除**：点击"删除"按钮（会弹出确认对话框）
- **启用/禁用**：通过编辑修改 `is_active` 状态

---

## 🔄 配置生效方式

### 自动生效
- 配置保存后立即生效
- 下一次聊天会话会使用新配置
- 无需重启服务器

### 优先级
1. **数据库配置**（优先）- 管理员界面添加的配置
2. **文件配置**（备用）- `/src/lib/custom-dr-k-config.ts` 中的配置

如果数据库中没有配置，系统会自动使用文件中的默认配置。

---

## 💡 使用建议

### 初始化配置

建议先添加一些基础配置：

**知识库**：
- 学习方法
- 情绪管理
- 人际关系

**场景提示词**：
- 孩子遇到困难
- 孩子分享成果
- 孩子表达负面情绪

**说话风格**：
- 基本原则
- 禁止事项

### 持续优化

1. **观察对话效果**
   - 查看 K博士的回复是否符合预期
   - 学生的反馈如何

2. **调整配置**
   - 根据实际效果调整知识库内容
   - 优化场景提示词
   - 微调说话风格

3. **添加新场景**
   - 发现新的对话场景时及时添加
   - 针对特定问题添加专门的知识库

---

## 🎨 配置示例

### 示例1：添加艺术创作知识库

```
标题: 艺术创作培养
主题分类: creativity
内容:
### 艺术创作知识库
- 发散思维：一个主题想出多种表现方式
- 跨界学习：从不同艺术形式获取灵感
- 容忍失败：创作需要不断尝试
- 记录灵感：随时记下有趣的想法
- 观察生活：艺术来源于生活
- 表达情感：用艺术表达内心感受
```

### 示例2：添加考试焦虑场景

```
标题: 考试焦虑
场景名称: exam_anxiety
内容:
当孩子表达考试焦虑时：
1. 接纳情绪："考试前紧张是很正常的"
2. 共情："换成我也会有这样的感受"
3. 帮助分析："你最担心的是什么？"
4. 提供方法："要不要试试深呼吸放松？"
5. 鼓励准备："你已经准备得怎么样了？"
6. 降低压力："考试只是检验学习，不代表全部"
```

### 示例3：添加回复长度规则

```
标题: 回复长度控制
分类: rules
内容:
## 回复长度规则
- 每次回复控制在 80-120 字
- 简洁有力，不啰嗦
- 一次只说一个重点
- 如果内容多，分多次对话
- 避免长篇大论
```

---

## 🔍 查看配置效果

### 方法一：直接测试
1. 在管理界面添加配置
2. 访问聊天页面：http://localhost:3000/dashboard/chat
3. 发送相关话题的消息
4. 观察 K博士的回复

### 方法二：查看系统提示词
在聊天 API 中添加日志：
```typescript
console.log('System Prompt:', systemPrompt)
```

---

## 📊 配置管理最佳实践

### 1. 分类清晰
- 知识库按主题分类（learning, emotion, social 等）
- 场景按触发条件分类（difficulty, achievement 等）
- 说话风格按类型分类（style, rules 等）

### 2. 内容具体
- 避免空泛的描述
- 给出具体的例子
- 提供可操作的指导

### 3. 持续迭代
- 定期查看聊天记录
- 根据效果调整配置
- 删除无效的配置

### 4. 保持简洁
- 不要添加过多重复的内容
- 每个配置项专注一个主题
- 定期清理过时的配置

---

## 🆘 常见问题

### Q: 配置保存后没有生效？
A: 刷新聊天页面，开始新的对话会话。

### Q: 可以同时使用数据库配置和文件配置吗？
A: 系统优先使用数据库配置。如果数据库为空，会使用文件配置。

### Q: 如何备份配置？
A: 在 Supabase Dashboard 中导出表数据，或使用 SQL 查询导出。

### Q: 配置太多会影响性能吗？
A: 建议保持在 50 个配置项以内。系统会缓存配置，性能影响很小。

### Q: 如何恢复默认配置？
A: 删除数据库中的所有配置，系统会自动使用文件中的默认配置。

---

## 🚀 下一步

1. **创建数据库表**（必须）
2. **访问管理页面**：http://localhost:3000/admin/dr-k-config
3. **添加初始配置**
4. **测试聊天效果**
5. **持续优化配置**

---

现在你可以随时在管理界面中更新 K博士的知识库和提示词了！🎉
